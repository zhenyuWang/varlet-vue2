var w=Object.defineProperty;var h=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var p=(t,n,e)=>n in t?w(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,l=(t,n)=>{for(var e in n||(n={}))S.call(n,e)&&p(t,e,n[e]);if(h)for(var e of h(n))$.call(n,e)&&p(t,e,n[e]);return t};import{p as y,S as I}from"./index.db7ea5fc.js";import{S as x}from"./index.3f174f1c.js";import{I as Y}from"./index.1f79a394.js";import{p as X,P as C}from"./index.89a8aba0.js";import{d as D}from"./create.242e0646.js";import{p as m,m as k}from"./components.1b7f472c.js";import{t as d,h as z,d as V,e as b}from"./shared.f8da68a0.js";import{n as M}from"./index.6222f8b9.js";import{V as A}from"./vendor.4f0eb98f.js";const F=l(l({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1}},m(y,["loop","indicator"])),m(X,["lockScroll","teleport"]));var N=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("var-popup",{staticClass:"var-image-preview__popup",attrs:{"var-image-preview-cover":"",transition:"var-fade",show:t.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":t.lockScroll,teleport:t.teleport},on:{open:function(o){return t.$emit("open")},close:function(o){return t.$emit("close")},closed:function(o){return t.$emit("closed")},opened:function(o){return t.$emit("opened")},"route-change":function(o){return t.$emit("route-change")}}},[e("var-swipe",t._b({staticClass:"var-image-preview__swipe",attrs:{"var-image-preview-cover":"",touchable:t.canSwipe,indicator:t.indicator&&t.images.length>1,"initial-index":t.initialIndex,loop:t.loop},on:{change:function(o){return t.$emit("change",o)}},scopedSlots:t._u([{key:"default",fn:function(){return t._l(t.images,function(o){return e("var-swipe-item",{key:o,staticClass:"var-image-preview__swipe-item",attrs:{"var-image-preview-cover":""}},[e("div",{staticClass:"var-image-preview__zoom-container",style:{transform:"scale("+t.scale+") translate("+t.translateX+"px, "+t.translateY+"px)",transitionTimingFunction:t.transitionTimingFunction,transitionDuration:t.transitionDuration},on:{touchstart:t.handleTouchstart,touchmove:t.handleTouchmove,touchend:t.handleTouchend}},[e("img",{staticClass:"var-image-preview__image",attrs:{src:o,alt:o}})])])})},proxy:!0},{key:"indicator",fn:function(o){var i=o.index,r=o.length;return[t._t("indicator",function(){return[t.indicator&&t.images.length>1?e("div",{staticClass:"var-image-preview__indicators"},[t._v(" "+t._s(i+1)+" / "+t._s(r)+" ")]):t._e()]},{index:i,length:r})]}}],null,!0)},"var-swipe",t.$attrs,!1)),t._t("close-icon",function(){return[t.closeable?e("var-icon",{staticClass:"var-image-preview__close-icon",attrs:{name:"close-circle","var-image-preview-cover":""},on:{click:t.close}}):t._e()]}),e("div",{staticClass:"var-image-preview__extra"},[t._t("extra")],2)],2)},R=[];const v=12,f=200,g=200,E=D({name:"VarImagePreview",components:{VarSwipe:I,VarSwipeItem:x,VarPopup:C,VarIcon:Y},inheritAttrs:!1,props:F,data:()=>({popupShow:!1,scale:1,translateX:0,translateY:0,transitionTimingFunction:void 0,transitionDuration:void 0,canSwipe:!0,startTouch:null,prevTouch:null,checker:null}),computed:{initialIndex(){const{images:t,current:n}=this,e=t.findIndex(o=>o===n);return e>=0?e:0}},watch:{show:{handler(t){this.popupShow=t},immediate:!0}},methods:{getDistance(t,n){const{clientX:e,clientY:o}=t,{clientX:i,clientY:r}=n;return Math.abs(Math.sqrt((i-e)**2+(r-o)**2))},createVarTouch(t,n){return{clientX:t.clientX,clientY:t.clientY,timestamp:Date.now(),target:n}},zoomIn(){this.scale=d(this.zoom),this.canSwipe=!1,this.prevTouch=null,window.setTimeout(()=>{this.transitionTimingFunction="linear",this.transitionDuration="0s"},g)},zoomOut(){this.scale=1,this.translateX=0,this.translateY=0,this.canSwipe=!0,this.prevTouch=null,this.transitionTimingFunction=void 0,this.transitionDuration=void 0},isDoubleTouch(t){return this.prevTouch?this.getDistance(this.prevTouch,t)<=v&&t.timestamp-this.prevTouch.timestamp<=f&&this.prevTouch.target===t.target:!1},isTapTouch(t){return!t||!this.startTouch||!this.prevTouch?!1:this.getDistance(this.startTouch,this.prevTouch)<=v&&(t===this.startTouch.target||t.parentNode===this.startTouch.target)},handleTouchend(t){this.checker=window.setTimeout(()=>{this.isTapTouch(t.target)&&this.close(),this.startTouch=null},f)},handleTouchstart(t){this.checker&&window.clearTimeout(this.checker);const{touches:n}=t,e=this.createVarTouch(n[0],t.currentTarget);if(this.startTouch=e,this.isDoubleTouch(e)){this.scale>1?this.zoomOut():this.zoomIn();return}this.prevTouch=e},getZoom(t){const{offsetWidth:n,offsetHeight:e}=t,{naturalWidth:o,naturalHeight:i}=t.querySelector(".var-image-preview__image");return{width:n,height:e,imageRadio:i/o,rootRadio:e/n,zoom:d(this.zoom)}},getLimitX(t){const{zoom:n,imageRadio:e,rootRadio:o,width:i,height:r}=this.getZoom(t);if(!e)return 0;const c=e>o?r/e:i;return Math.max(0,(n*c-i)/2)/n},getLimitY(t){const{zoom:n,imageRadio:e,rootRadio:o,width:i,height:r}=this.getZoom(t);if(!e)return 0;const c=e>o?r:i*e;return Math.max(0,(n*c-r)/2)/n},getMoveTranslate(t,n,e){return t+n>=e?e:t+n<=-e?-e:t+n},handleTouchmove(t){if(!this.prevTouch)return;const n=t.currentTarget,{touches:e}=t,o=this.createVarTouch(e[0],n);if(this.scale>1){const i=o.clientX-this.prevTouch.clientX,r=o.clientY-this.prevTouch.clientY,c=this.getLimitX(n),_=this.getLimitY(n);this.translateX=this.getMoveTranslate(this.translateX,i,c),this.translateY=this.getMoveTranslate(this.translateY,r,_)}this.prevTouch=o},close(){if(this.scale>1){this.zoomOut(),window.setTimeout(()=>this.$emit("update:show",!1),g);return}this.$emit("update:show",!1)}}}),T={};var L=M(E,N,R,!1,B,null,null,null);function B(t){for(let n in T)this[n]=T[n]}var s=function(){return L.exports}();let a;function u(t){if(!z())return;u.close();const n=V(t)?{images:[t]}:b(t)?{images:t}:t,{instance:e,unmount:o}=k(s,"body",{propsData:l({},n)});e.show=!0,a=e,e.$on("open",()=>{var i;return(i=n.onOpen)==null?void 0:i.call(n)}),e.$on("opened",()=>{var i;return(i=n.onOpened)==null?void 0:i.call(n)}),e.$on("close",()=>{var i;return(i=n.onClose)==null?void 0:i.call(n)}),e.$on("closed",()=>{var i;(i=n.onClosed)==null||i.call(n),o(),a===n&&(a=null)}),e.$on("change",i=>{var r;(r=n.onChange)==null||r.call(n,i)}),e.$on("route-change",()=>{o(),a===e&&(a=null)}),e.$on("update:show",i=>{e.show=i}),e.show=!0}u.close=()=>{if(a!=null){const t=a;a=null,A.nextTick(()=>{t.show=!1})}};s.install=function(t){t.component(s.name,s)};u.install=function(t){t.component(s.name,s)};u.Component=s;export{u as I};
