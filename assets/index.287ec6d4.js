import{d as f}from"./create.242e0646.js";import{h as m,n as w}from"./elements.9c883ade.js";import{t as l,i as v}from"./shared.f8da68a0.js";import{a as g}from"./relation.9e421618.js";import{n as I}from"./index.31927c0d.js";const x={loop:{type:Boolean,default:!0},autoplay:{type:[String,Number]},duration:{type:[String,Number],default:300},initialIndex:{type:[String,Number],default:0},indicator:{type:Boolean,default:!0},indicatorColor:{type:String},vertical:{type:Boolean,default:!1},touchable:{type:Boolean,default:!0}};var _=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"swipeEl",staticClass:"var-swipe"},[i("div",{staticClass:"var-swipe__track",class:[t.vertical?"var-swipe--vertical":null],style:{width:t.vertical?void 0:t.trackSize+"px",height:t.vertical?t.trackSize+"px":void 0,transform:"translate"+(t.vertical?"Y":"X")+"("+t.translate+"px)",transitionDuration:t.lockDuration?"0ms":t.toNumber(t.duration)+"ms"},on:{touchstart:t.handleTouchstart,touchmove:t.handleTouchmove,touchend:t.handleTouchend}},[t._t("default")],2),t._t("indicator",function(){return[t.indicator&&t.swipeItems.length?i("div",{staticClass:"var-swipe__indicators",class:[t.vertical?"var-swipe--indicators-vertical":null]},t._l(t.swipeItems.length,function(s,n){return i("div",{key:s,staticClass:"var-swipe__indicator",class:[t.index===n?"var-swipe--indicator-active":null,t.vertical?"var-swipe--indicator-vertical":null],style:{background:t.indicatorColor},on:{click:function(r){return t.to(n)}}})}),0):t._e()]},{index:t.index,length:t.swipeItems.length})],2)},S=[];const y=250,z=20,T=f({name:"VarSwipe",mixins:[g("swipe",{childrenKey:"swipeItems"})],props:x,data:()=>({size:0,trackSize:0,translate:0,lockDuration:!1,index:0,touching:!1,timer:-1,startX:void 0,startY:void 0,startTime:void 0,prevX:void 0,prevY:void 0}),mounted(){window.addEventListener("resize",this.resize)},beforeDestroy(){window.removeEventListener("resize",this.resize),this.stopAutoplay()},watch:{async swipeItems(){await m(),this._initialIndex(),this.resize()}},methods:{resize(){this.lockDuration=!0,this.size=this.vertical?this.$refs.swipeEl.offsetHeight:this.$refs.swipeEl.offsetWidth,this.trackSize=this.size*this.swipeItems.length,this.translate=this.index*-this.size,this.swipeItems.forEach(t=>{t.setTranslate(0)}),this.startAutoplay(),window.setTimeout(()=>{this.lockDuration=!1})},next(){var s,n;if(this.swipeItems.length<=1)return;const{loop:t,getListeners:e}=this,i=this.index;this.index=this.boundaryIndex(i+1),(n=(s=e()).onChange)==null||n.call(s,this.index),this.fixPosition(()=>{if(i===this.swipeItems.length-1&&t){this.findSwipeItem(0).setTranslate(this.trackSize),this.translate=this.swipeItems.length*-this.size;return}i!==this.swipeItems.length-1&&(this.translate=this.index*-this.size)})},prev(){var s,n;if(this.swipeItems.length<=1)return;const{loop:t,getListeners:e}=this,i=this.index;this.index=this.boundaryIndex(i-1),(n=(s=e()).onChange)==null||n.call(s,this.index),this.fixPosition(()=>{if(i===0&&t){this.findSwipeItem(this.swipeItems.length-1).setTranslate(-this.trackSize),this.translate=this.size;return}i!==0&&(this.translate=this.index*-this.size)})},to(t){if(this.swipeItems.length<=1||t===this.index)return;t=t<0?0:t,t=t>=this.swipeItems.length?this.swipeItems.length:t;const e=t>this.index?this.next:this.prev;Array.from({length:Math.abs(t-this.index)}).forEach(e)},toNumber:l,findSwipeItem(t){return this.swipeItems.find(({index:e})=>e===t)},dispatchBorrower(){const{translate:t,trackSize:e,size:i,loop:s,swipeItems:n}=this,{length:r}=n;!s||(t>=0&&this.findSwipeItem(r-1).setTranslate(-e),t<=-(e-i)&&this.findSwipeItem(0).setTranslate(e),t>-(e-i)&&t<0&&(this.findSwipeItem(r-1).setTranslate(0),this.findSwipeItem(0).setTranslate(0)))},getSwipeIndex(t){const{translate:e,size:i,swipeItems:s,loop:n}=this,r=v(t)?t:Math.floor((e-i/2)/-i);return r<=-1?n?-1:0:r>=s.length?n?s.length:s.length-1:r},swipeIndexToIndex(t){const{loop:e,swipeItems:i}=this;return t===-1?e?i.length-1:0:t===i.length?e?0:i.length-1:t},boundaryIndex(t){const{loop:e,swipeItems:i}=this;return t<0?e?i.length-1:0:t>i.length-1?e?0:i.length-1:t},fixPosition(t){const{translate:e,size:i,trackSize:s,swipeItems:n}=this,r=e>=i,a=e<=-s,o=0,h=-(s-i);this.lockDuration=!0,(r||a)&&(this.lockDuration=!0,this.translate=a?o:h,this.findSwipeItem(0).setTranslate(0),this.findSwipeItem(n.length-1).setTranslate(0)),w(()=>{this.lockDuration=!1,t==null||t()})},_initialIndex(){this.index=this.boundaryIndex(l(this.initialIndex))},startAutoplay(){const{autoplay:t,swipeItems:e}=this;!t||e.length<=1||(this.stopAutoplay(),this.timer=window.setTimeout(()=>{this.next(),this.startAutoplay()},l(t)))},stopAutoplay(){this.timer&&window.clearTimeout(this.timer)},getDirection(t,e){if(t>e&&t>10)return"horizontal";if(e>t&&e>10)return"vertical"},handleTouchstart(t){if(this.swipeItems.length<=1||!this.touchable)return;const{clientX:e,clientY:i}=t.touches[0];this.startX=e,this.startY=i,this.startTime=performance.now(),this.touching=!0,this.stopAutoplay(),this.fixPosition(()=>{this.lockDuration=!0})},handleTouchmove(t){const{touchable:e,vertical:i}=this;if(!this.touching||!e)return;const{clientX:s,clientY:n}=t.touches[0],r=Math.abs(s-this.startX),a=Math.abs(n-this.startY);if(this.getDirection(r,a)===(i?"vertical":"horizontal")){t.preventDefault();const p=this.prevX!==void 0?s-this.prevX:0,d=this.prevY!==void 0?n-this.prevY:0;this.prevX=s,this.prevY=n,this.translate+=i?d:p,this.dispatchBorrower()}},handleTouchend(){var o,h;if(!this.touching)return;const{vertical:t,getListeners:e}=this,i=t?this.prevY<this.startY:this.prevX<this.startX,s=Math.abs(t?this.startY-this.prevY:this.startX-this.prevX),r=performance.now()-this.startTime<=y&&s>=z?i?this.getSwipeIndex(this.index+1):this.getSwipeIndex(this.index-1):this.getSwipeIndex();this.touching=!1,this.lockDuration=!1,this.prevX=void 0,this.prevY=void 0,this.translate=r*-this.size;const a=this.index;this.index=this.swipeIndexToIndex(r),this.startAutoplay(),a!==this.index&&((h=(o=e()).onChange)==null||h.call(o,this.index))}}}),u={};var k=I(T,_,S,!1,b,null,null,null);function b(t){for(let e in u)this[e]=u[e]}var c=function(){return k.exports}();c.install=function(t){t.component(c.name,c)};export{c as S,x as p};
