var w=Object.defineProperty;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var g=(t,a,e)=>a in t?w(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,z=(t,a)=>{for(var e in a||(a={}))I.call(a,e)&&g(t,e,a[e]);if(y)for(var e of y(a))b.call(a,e)&&g(t,e,a[e]);return t};import{j as R,k as O}from"./elements.9c883ade.js";import{r as C,j as p,s as G}from"./shared.f8da68a0.js";const N="background-image",W="lazy-loading",B="lazy-error",h="lazy-attempt",P=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],f="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",s=[],u=[],_=G(100),r={loading:f,error:f,attempt:3,throttleWait:300,events:P};let l=p(i,r.throttleWait);function A(t,a){var e;((e=t._lazy)==null?void 0:e.arg)===N?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function T(t){var a;((a=t._lazy)==null?void 0:a.loading)&&A(t,t._lazy.loading),i()}function D(t){var a;((a=t._lazy)==null?void 0:a.error)&&A(t,t._lazy.error),t._lazy.state="error",d(t),i()}function E(t,a){A(t,a),t._lazy.state="success",d(t),i()}function M(t){var a;u.includes(t)||(u.push(t),(a=r.events)==null||a.forEach(e=>{t.addEventListener(e,l,{passive:!0})}))}function S(){u.forEach(t=>{var a;(a=r.events)==null||a.forEach(e=>{t.removeEventListener(e,l)})}),u.length=0}function Y(t,a){var n,o,c;const e={loading:(n=t.getAttribute(W))!=null?n:r.loading,error:(o=t.getAttribute(B))!=null?o:r.error,attempt:t.getAttribute(h)?Number(t.getAttribute(h)):r.attempt};t._lazy=z({src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1},e),A(t,f),(c=r.filter)==null||c.call(r,t._lazy)}function Z(t,a){const e=new Image;e.src=a,t._lazy.preloadImage=e,e.addEventListener("load",()=>{t._lazy.attemptLock=!1,_.add(a),E(t,a)}),e.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?D(t):L(t)})}function L(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(_.has(a)){E(t,a),t._lazy.attemptLock=!1;return}T(t),Z(t,a)}async function m(t){await R(t)&&L(t)}function i(){s.forEach(t=>m(t))}async function j(t){!s.includes(t)&&s.push(t),O(t).forEach(M),await m(t)}function d(t){C(s,t),s.length===0&&S()}function V(t,a){const{src:e,arg:n}=t._lazy;return e!==a.value||n!==a.arg}async function v(t,a){Y(t,a),await j(t)}async function x(t,a){if(!V(t,a)){s.includes(t)&&await m(t);return}await v(t,a)}function H(t={}){const{events:a,loading:e,error:n,attempt:o,throttleWait:c,filter:k}=t;r.events=a!=null?a:r.events,r.loading=e!=null?e:r.loading,r.error=n!=null?n:r.error,r.attempt=o!=null?o:r.attempt,r.throttleWait=c!=null?c:r.throttleWait,r.filter=k}const X={inserted:v,unbind:d,update:x,install(t,a){H(a),l=p(i,r.throttleWait),t.directive("lazy",this)}};export{X as L};
